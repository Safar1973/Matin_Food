const translations = {
    en: {
        home: "Home",
        about: "About Us",
        products: "Products",
        categories: "Categories",
        price: "Price",
        expiry: "Expiry Date",
        delivery: "Delivery",
        payment: "Payment",
        addToCart: "Add to Cart",
        currency: "$",
        buyInfo: "Online, cash on delivery or card",
        deliveryTime: "24-48 Hours",
        cartTitle: "Shopping Cart",
        cartEmpty: "Your cart is empty",
        total: "Total",
        paymentMethodsTitle: "Payment methods",
        paymentOnline: "Online payment (card / PayPal)",
        paymentCash: "Cash on delivery",
        clearCart: "Clear all",
        checkout: "Checkout",
        homeTitle: "Welcome to Matin Food Gmbh",
        homeSubtitle: "Fresh and quality products delivered to your door.",
        homeShopBtn: "Shop now",
        headerSloganTitle: "Welcome to Matin Food Gmbh",
        headerSloganText: "Fresh and quality products delivered to your door.",
        aboutTitle: "About Matin Food Gmbh",
        aboutText:
            "We are a genuine organic shop in Oberhausen, serving you for 10 years.",
        aboutBackHome: "Back to Home",
        checkoutTitle: "Checkout",
        checkoutInfo:
            "Please fill in your details and choose your preferred payment method.",
        formName: "Full name",
        formAddress: "Address",
        formCity: "City",
        formPhone: "Phone",
        formPaymentSelect: "Payment method",
        optOnline: "Online payment (card / PayPal)",
        optCard: "Card on delivery",
        optCash: "Cash on delivery",
        placeOrder: "Place Order",
        backHome: "Back to Home",
        backProducts: "Back to Products",
        orderSummary: "Order summary",
        orderTotalLabel: "Total:",
        orderPlacedMsg: "Your order has been placed (demo only).",
        cats: {
            all: "All Products",
            grains: "Grains & Pulses",
            syrups: "Syrups & Jams",
            honey: "Honey & Spreads",
            dairy: "Dairy & Cheese",
            meat: "Meat & Poultry",
            drinks: "Coffee & Tea",
            canned: "Canned Goods",
            produce: "Fruits & Vegetables"
        }
    },
    de: {
        home: "Startseite",
        about: "Ãœber uns",
        products: "Produkte",
        categories: "Kategorien",
        price: "Preis",
        expiry: "Haltbarkeit",
        delivery: "Lieferung",
        payment: "Zahlung",
        addToCart: "In den Warenkorb",
        currency: "â‚¬",
        buyInfo: "Online, Barzahlung oder Karte",
        deliveryTime: "24-48 Stunden",
        cartTitle: "Warenkorb",
        cartEmpty: "Ihr Warenkorb ist leer",
        total: "Summe",
        paymentMethodsTitle: "Zahlungsarten",
        paymentOnline: "Online-Zahlung (Karte / PayPal)",
        paymentCash: "Barzahlung bei Lieferung",
        clearCart: "Alles lÃ¶schen",
        checkout: "Zur Kasse",
        homeTitle: "Willkommen bei Matin Food Gmbh",
        homeSubtitle:
            "Frische und hochwertige Produkte direkt zu Ihnen nach Hause.",
        homeShopBtn: "Jetzt einkaufen",
        headerSloganTitle: "Willkommen bei Matin Food Gmbh",
        headerSloganText: "Frische und hochwertige Produkte direkt zu Ihnen nach Hause.",
        aboutTitle: "Ãœber Matin Food",
        aboutText:
            "Wir sind ein echter Bio-Laden in Oberhausen seit 10 Jahren.",
        aboutBackHome: "Zur Startseite",
        checkoutTitle: "Kasse",
        checkoutInfo:
            "Bitte fÃ¼llen Sie Ihre Daten aus und wÃ¤hlen Sie die gewÃ¼nschte Zahlungsmethode.",
        formName: "VollstÃ¤ndiger Name",
        formAddress: "Adresse",
        formCity: "Stadt",
        formPhone: "Telefon",
        formPaymentSelect: "Zahlungsart",
        optOnline: "Online-Zahlung (Karte / PayPal)",
        optCard: "Kartenzahlung bei Lieferung",
        optCash: "Barzahlung bei Lieferung",
        placeOrder: "Bestellung abschicken",
        backHome: "Zur Startseite",
        backProducts: "Zu den Produkten",
        orderSummary: "BestellÃ¼bersicht",
        orderTotalLabel: "Summe:",
        orderPlacedMsg: "Ihre Bestellung wurde gesendet (Demo).",
        cats: {
            all: "Alle Produkte",
            grains: "Getreide & HÃ¼lsenfrÃ¼chte",
            syrups: "Sirup & Marmelade",
            honey: "Honig & Aufstriche",
            dairy: "Milchprodukte & KÃ¤se",
            meat: "Fleisch & GeflÃ¼gel",
            drinks: "Kaffee & Tee",
            canned: "Konserven",
            produce: "Obst & GemÃ¼se"
        }
    },
    ar: {
        home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        about: "Ù…Ù† Ù†Ø­Ù†",
        products: "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
        categories: "Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª",
        price: "Ø§Ù„Ø³Ø¹Ø±",
        expiry: "ØªØ§Ø±ÙŠØ® Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©",
        delivery: "Ø§Ù„ØªÙˆØµÙŠÙ„",
        payment: "Ø§Ù„Ø¯ÙØ¹",
        addToCart: "Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©",
        currency: "â‚¬",
        buyInfo: "Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø£Ùˆ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø£Ùˆ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©",
        deliveryTime: "24-48 Ø³Ø§Ø¹Ø©",
        cartTitle: "Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª",
        cartEmpty: "Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙØ§Ø±ØºØ©",
        total: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹",
        paymentMethodsTitle: "Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹",
        paymentOnline: "Ø¯ÙØ¹ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (Ø¨Ø·Ø§Ù‚Ø© / Ø¨Ø§ÙŠØ¨Ø§Ù„)",
        paymentCash: "Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…",
        clearCart: "ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©",
        checkout: "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡",
        homeTitle: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØªÙŠÙ† ÙÙˆØ¯ Ù…Ø§Ø±ÙƒØª",
        homeSubtitle: "Ù†ÙˆÙØ± Ù„Ùƒ Ù…Ù†ØªØ¬Ø§Øª ØºØ°Ø§Ø¦ÙŠØ© Ø·Ø§Ø²Ø¬Ø© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© Ø¥Ù„Ù‰ Ø¨Ø§Ø¨ Ù…Ù†Ø²Ù„Ùƒ.",
        homeShopBtn: "Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
        headerSloganTitle: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…ØªÙŠÙ† ÙÙˆØ¯ Gmbh",
        headerSloganText: "Ù†ÙˆÙØ± Ù„Ùƒ Ù…Ù†ØªØ¬Ø§Øª ØºØ°Ø§Ø¦ÙŠØ© Ø·Ø§Ø²Ø¬Ø© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© Ø¥Ù„Ù‰ Ø¨Ø§Ø¨ Ù…Ù†Ø²Ù„Ùƒ.",
        aboutTitle: "Ù…Ù† Ù†Ø­Ù†",
        aboutText:
            "Ù†Ø­Ù† Ù…ØªØ¬Ø± Ø¹Ø¶ÙˆÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ø£ÙˆØ¨Ø±Ù‡Ø§ÙˆØ²Ù†ØŒ ÙÙŠ Ø®Ø¯Ù…ØªÙƒÙ… Ù…Ù†Ø° 10 Ø³Ù†ÙˆØ§Øª.",
        aboutBackHome: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        checkoutTitle: "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨",
        checkoutInfo:
            "ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ùƒ.",
        formName: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„",
        formAddress: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
        formCity: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
        formPhone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
        formPaymentSelect: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹",
        optOnline: "Ø¯ÙØ¹ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (Ø¨Ø·Ø§Ù‚Ø© / Ø¨Ø§ÙŠØ¨Ø§Ù„)",
        optCard: "Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…",
        optCash: "Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…",
        placeOrder: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨",
        backHome: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        backProducts: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª",
        orderSummary: "Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨",
        orderTotalLabel: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:",
        orderPlacedMsg: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ (ØªØ¬Ø±ÙŠØ¨ÙŠ).",
        cats: {
            all: "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
            grains: "Ø§Ù„Ø­Ø¨ÙˆØ¨ ÙˆØ§Ù„Ø¨Ù‚ÙˆÙ„ÙŠØ§Øª",
            syrups: "Ø§Ù„Ø¯Ø¨Ø³ ÙˆØ§Ù„Ù…Ø±Ø¨ÙŠØ§Øª",
            honey: "Ø§Ù„Ø¹Ø³Ù„ ÙˆØ§Ù„Ø²Ø¹ØªØ±",
            dairy: "Ø§Ù„Ø£Ù„Ø¨Ø§Ù† ÙˆØ§Ù„Ø£Ø¬Ø¨Ø§Ù†",
            meat: "Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ§Ù„Ø¯ÙˆØ§Ø¬Ù†",
            drinks: "Ø§Ù„Ù‚Ù‡ÙˆØ© ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª",
            canned: "Ø§Ù„Ù…Ø¹Ù„Ø¨Ø§Øª",
            produce: "Ø§Ù„Ø®Ø¶Ø§Ø± ÙˆØ§Ù„ÙÙˆØ§ÙƒÙ‡"
        }
    }
};

let products = [];

async function fetchProducts() {
    try {
        const res = await fetch('api/get_products.php');
        if (!res.ok) throw new Error('Failed to fetch products');
        products = await res.json();
        renderProducts();
    } catch (err) {
        console.error(err);
        alert('Error loading products');
    }
}

let currentLang = "de";
let cart = []; // { product, qty }

/* ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© ÙˆØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø§Ù„Ù†ØµÙˆØµ */
function setLanguage(lang) {
    currentLang = lang;
    const t = translations[lang];

    // Update direction (RTL Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)
    document.body.className = lang === "ar" ? "rtl" : "";

    // Header nav
    document.getElementById("nav-home").textContent = t.home;
    document.getElementById("nav-about").textContent = t.about;
    document.getElementById("nav-products").textContent = t.products;

    // Home section
    document.getElementById("home-title").textContent = t.homeTitle;
    document.getElementById("home-subtitle").textContent = t.homeSubtitle;
    document.getElementById("home-shop-btn").textContent = t.homeShopBtn;

    // Header slogan
    document.getElementById("header-slogan-title").textContent = t.headerSloganTitle;
    document.getElementById("header-slogan-text").textContent = t.headerSloganText;

    // Sidebar title
    document.getElementById("sidebar-title").textContent = t.categories;

    // About
    document.getElementById("about-title").textContent = t.aboutTitle;
    document.getElementById("about-text").textContent = t.aboutText;
    document.getElementById("about-back-home").textContent = t.aboutBackHome;

    // Checkout texts
    document.getElementById("checkout-title").textContent = t.checkoutTitle;
    document.getElementById("checkout-info").textContent = t.checkoutInfo;

    document.getElementById("label-name").textContent = t.formName;
    document.getElementById("label-address").textContent = t.formAddress;
    document.getElementById("label-city").textContent = t.formCity;
    document.getElementById("label-phone").textContent = t.formPhone;
    document.getElementById("label-payment-select").textContent =
        t.formPaymentSelect;

    document.getElementById("opt-online").textContent = t.optOnline;
    document.getElementById("opt-card").textContent = t.optCard;
    document.getElementById("opt-cash").textContent = t.optCash;

    document.getElementById("place-order-btn").textContent = t.placeOrder;
    document.getElementById("back-home-btn").textContent = t.backHome;
    document.getElementById("back-products-btn").textContent = t.backProducts;

    document.getElementById("order-summary-title").textContent =
        t.orderSummary;
    document.getElementById("order-total-label").textContent =
        t.orderTotalLabel;

    // Cart texts
    document.getElementById("cart-title").textContent = t.cartTitle;
    document.getElementById("cart-total-label").textContent = t.total + ":";

    document.getElementById("payment-methods-title").textContent =
        t.paymentMethodsTitle;
    document.getElementById("payment-method-online").textContent =
        t.paymentOnline;
    document.getElementById("payment-method-cash").textContent = t.paymentCash;

    document.getElementById("clear-cart-btn").textContent = t.clearCart;
    document.getElementById("checkout-btn").textContent = t.checkout;

    // Categories
    const catList = document.getElementById("category-list");
    catList.innerHTML = "";

    // ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ: Ø§Ù„ÙƒÙ„
    const allLi = document.createElement("li");
    const allLink = document.createElement("a");
    allLink.href = "#";
    allLink.className = "active";
    allLink.textContent = t.cats.all;
    allLink.onclick = e => {
        e.preventDefault();
        setActiveCategoryLink(allLink);
        renderProducts("all");
    };
    allLi.appendChild(allLink);
    catList.appendChild(allLi);

    for (const [key, value] of Object.entries(t.cats)) {
        if (key === "all") continue;
        const li = document.createElement("li");
        const link = document.createElement("a");
        link.href = "#";
        link.textContent = value;
        link.onclick = e => {
            e.preventDefault();
            setActiveCategoryLink(link);
            renderProducts(key);
        };
        li.appendChild(link);
        catList.appendChild(li);
    }

    renderProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Øª
    updateCartUI(); // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ø³Ù„Ø©
    updateOrderSummary();
}

/* ØªÙØ¹ÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØ§ØªÙŠØ¬ÙˆØ±ÙŠ */
function setActiveCategoryLink(activeLink) {
    document
        .querySelectorAll(".category-list a")
        .forEach(a => a.classList.remove("active"));
    if (activeLink) activeLink.classList.add("active");
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
function renderProducts(filter = "all") {
    const grid = document.getElementById("product-grid");
    grid.innerHTML = "";

    const t = translations[currentLang];

    const filtered =
        filter === "all"
            ? products
            : products.filter(p => p.category === filter);

    filtered.forEach(p => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.onclick = () => showModal(p);

        card.innerHTML = `
            <img src="${p.img}" alt="${p.names[currentLang]}" class="product-image">
            <div class="product-info">
                <div class="product-title">${p.names[currentLang]}</div>
                <div class="product-price">${p.price.toFixed(2)} ${t.currency
            }</div>
            </div>
        `;
        grid.appendChild(card);
    });
}

/* Modal Ø§Ù„Ù…Ù†ØªØ¬ */
function showModal(product) {
    const modal = document.getElementById("product-modal");
    const t = translations[currentLang];

    document.getElementById("modal-img").src = product.img;
    document.getElementById("modal-title").textContent =
        product.names[currentLang];
    document.getElementById("modal-price").textContent =
        product.price.toFixed(2) + " " + t.currency;

    const details = document.getElementById("modal-details-content");
    details.innerHTML = `
        <div class="detail-row"><span>${t.expiry}:</span> <span>${product.expiry
        }</span></div>
        <div class="detail-row"><span>${t.delivery}:</span> <span>${t.deliveryTime
        }</span></div>
        <div class="detail-row"><span>${t.payment}:</span> <span>${t.buyInfo
        }</span></div>
    `;

    const modalBtn = document.getElementById("modal-btn");
    modalBtn.textContent = t.addToCart;
    modalBtn.onclick = () => addToCart(product);

    modal.style.display = "flex";
}

function closeModal() {
    document.getElementById("product-modal").style.display = "none";
}

/* Cart functions */
function addToCart(product) {
    const existing = cart.find(item => item.product.id === product.id);
    if (existing) {
        existing.qty += 1;
    } else {
        cart.push({ product, qty: 1 });
    }
    updateCartUI();
    updateOrderSummary();
    closeModal();
}

/* Ø²ÙŠØ§Ø¯Ø© / Ø¥Ù†Ù‚Ø§Øµ ÙƒÙ…ÙŠØ© Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ø³Ù„Ø© */
function changeQty(productId, delta) {
    const item = cart.find(i => i.product.id === productId);
    if (!item) return;

    item.qty += delta;
    if (item.qty <= 0) {
        // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ùˆ Ø£ØµØ¨Ø­Øª Ø§Ù„ÙƒÙ…ÙŠØ© 0
        cart = cart.filter(i => i.product.id !== productId);
    }
    updateCartUI();
    updateOrderSummary();
}

/* Ø­Ø°Ù Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ù…Ù† Ø§Ù„Ø³Ù„Ø© ÙƒÙ„ÙŠØ§Ù‹ */
function removeItem(productId) {
    cart = cart.filter(i => i.product.id !== productId);
    updateCartUI();
    updateOrderSummary();
}

/* ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
function clearCart() {
    cart = [];
    updateCartUI();
    updateOrderSummary();
}

/* ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ù„Ø© */
function updateCartUI() {
    const t = translations[currentLang];

    const countEl = document.getElementById("cart-count");
    const itemsContainer = document.getElementById("cart-items");
    const totalEl = document.getElementById("cart-total");

    if (!itemsContainer) return;

    const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
    if (countEl) countEl.textContent = totalItems;

    itemsContainer.innerHTML = "";

    if (cart.length === 0) {
        itemsContainer.innerHTML = `<p class="cart-empty">${t.cartEmpty}</p>`;
        totalEl.textContent = `0.00 ${t.currency}`;
        return;
    }

    let total = 0;

    cart.forEach(item => {
        const row = document.createElement("div");
        row.className = "cart-item";

        const lineTotal = item.product.price * item.qty;
        total += lineTotal;

        row.innerHTML = `
            <div class="cart-item-info">
                <span class="cart-item-title">${item.product.names[currentLang]
            }</span>
                <span class="cart-item-qty">x${item.qty}</span>
                <div class="cart-item-controls">
                    <button class="qty-btn" onclick="changeQty(${item.product.id}, -1)">-</button>
                    <button class="qty-btn" onclick="changeQty(${item.product.id}, 1)">+</button>
                    <button class="remove-item-btn" onclick="removeItem(${item.product.id})">ğŸ—‘</button>
                </div>
            </div>
            <div class="cart-item-price">${lineTotal.toFixed(2)} ${t.currency
            }</div>
        `;
        itemsContainer.appendChild(row);
    });

    totalEl.textContent = `${total.toFixed(2)} ${t.currency}`;
}

/* ÙØªØ­ / Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ù„Ø© */
function toggleCart() {
    const panel = document.getElementById("cart-panel");
    panel.classList.toggle("open");
}

/* ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Ø²Ø± Checkout */
function openCheckout() {
    // Ù„Ùˆ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ù„Ø§ Ù†Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙØ¹
    if (cart.length === 0) {
        alert(translations[currentLang].cartEmpty);
        return;
    }
    toggleCart();
    goToSection("checkout-section");
}

/* ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ */
function updateOrderSummary() {
    const t = translations[currentLang];
    const container = document.getElementById("order-summary-items");
    const totalEl = document.getElementById("order-total-value");
    if (!container) return;

    container.innerHTML = "";

    if (cart.length === 0) {
        container.innerHTML = `<p class="cart-empty">${t.cartEmpty}</p>`;
        totalEl.textContent = `0.00 ${t.currency}`;
        return;
    }

    let total = 0;
    cart.forEach(item => {
        const lineTotal = item.product.price * item.qty;
        total += lineTotal;
        const div = document.createElement("div");
        div.className = "checkout-summary-item";
        div.innerHTML = `
            <span>${item.product.names[currentLang]} x${item.qty}</span>
            <span>${lineTotal.toFixed(2)} ${t.currency}</span>
        `;
        container.appendChild(div);
    });

    totalEl.textContent = `${total.toFixed(2)} ${t.currency}`;
}

/* Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ØªØ¬Ø±ÙŠØ¨ÙŠ) */
/* Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (Ø¹Ø¨Ø± Ø§Ù„Ù€ API) */
async function submitOrder(e) {
    e.preventDefault();
    const t = translations[currentLang];
    if (cart.length === 0) {
        alert(t.cartEmpty);
        return;
    }

    const orderData = {
        customer: {
            name: document.getElementById("cust-name").value,
            address: document.getElementById("cust-address").value,
            city: document.getElementById("cust-city").value,
            phone: document.getElementById("cust-phone").value,
        },
        paymentMethod: document.getElementById("payment-method-select").value,
        items: cart,
        total: cart.reduce((sum, item) => sum + item.product.price * item.qty, 0)
    };

    try {
        const res = await fetch('api/place_order.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderData)
        });

        const result = await res.json();
        if (result.success) {
            alert("Order placed successfully! Order ID: " + result.orderId);
            clearCart();
            goToSection('home-section');
        } else {
            alert("Failed to place order: " + (result.error || 'Unknown error'));
        }
    } catch (err) {
        console.error(err);
        alert("Error submitting order.");
    }
}

/* Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª (Home / Products / About / Checkout) */
function goToSection(sectionId) {
    document
        .querySelectorAll(".page-section")
        .forEach(sec => sec.classList.remove("active"));
    const target = document.getElementById(sectionId);
    if (target) target.classList.add("active");

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø©
    document
        .querySelectorAll(".nav-links a")
        .forEach(a => a.classList.remove("active-link"));

    if (sectionId === "home-section") {
        document
            .getElementById("nav-home")
            .classList.add("active-link");
    } else if (sectionId === "products-section") {
        document
            .getElementById("nav-products")
            .classList.add("active-link");
    } else if (sectionId === "about-section") {
        document
            .getElementById("nav-about")
            .classList.add("active-link");
    }
}

/* Ø±Ø¨Ø· Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙŠ Ø§Ù„Ù€ header */
function setupNavLinks() {
    document.querySelectorAll(".nav-links a").forEach(link => {
        link.addEventListener("click", e => {
            e.preventDefault();
            const sectionId = link.getAttribute("data-section");
            if (sectionId) {
                goToSection(sectionId);
            }
        });
    });
}

/* Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ */
window.onclick = function (event) {
    const modal = document.getElementById("product-modal");
    if (event.target === modal) {
        closeModal();
    }
};

/* Initialize */
document.addEventListener("DOMContentLoaded", () => {
    setupNavLinks();
    goToSection("home-section");
    setLanguage("de"); // Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    fetchProducts();
});
